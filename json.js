class t{static ATTRIBUTE=1;static COMPONENT=2;static ELEMENT=3;static FRAGMENT=4;static INTERPOLATION=5;static STATIC=6;get properties(){const{attributes:t}=this;if(t.length){const e={};for(const s of t)s.type<2?e[s.name]=s.value:Object.assign(e,s.value);return e}return null}}const e=Object.freeze([]),s=(t,e)=>t[e];function i(t,e,...s){const i=(this||JSON).parse(t,...s);return c.call({ids:i,nmsp:e||globalThis},i.pop())}function n(t,...e){const s=[],i=a.call(s,t);return s.push(i),(this||JSON).stringify(s,...e)}function c(i){const{type:n}=i;switch(n){case t.COMPONENT:i.value=i.name.split(".").reduce(s,this.nmsp);case t.ELEMENT:case t.FRAGMENT:return i.attributes=(i.attributes||e).map(c,this),i.children=(i.children||e).map(c,this),i.hasOwnProperty("id")&&(i.id=this.ids[i.id]),Object.setPrototypeOf(i,t.prototype);case t.INTERPOLATION:{const{value:e}=i;return{type:t.INTERPOLATION,value:e&&(e.i||c.call(this,e))}}}return i}function a(e){const{type:s}=e;switch(s){case t.COMPONENT:case t.ELEMENT:case t.FRAGMENT:{const i=new t;if(i.type=s,e.hasOwnProperty("id")){const t=this.indexOf(e.id);i.id=t<0?this.push(e.id)-1:t}const{attributes:n,children:c}=e;return n.length&&(i.attributes=n),c.length&&(i.children=c.map(a,this)),e.name&&(i.name=e.name),i}case t.INTERPOLATION:const{value:i}=e;return{...e,value:i instanceof t?a.call(this,i):{i:i}}}return e}export{i as parse,n as stringify};
